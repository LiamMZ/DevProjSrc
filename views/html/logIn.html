<!-- Propery of Hackerfam
Written by: Andrew Pavey -->

<!DOCTYPE html>

<html>

	<head>

		<link href="./css/logInStyle.css" type="text/css" rel="stylesheet"/>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

		<title>Login</title>
		<script>

			async function scrape() {
				var email = document.getElementById("emailInput").value;
				var password = document.getElementById("passwordInput").value;
				// document.getElementById("temp1").innerHTML = email;
				// document.getElementById("temp2").innerHTML = password;

				let login
				try {
					login = await post(`/login`, {email: email, password: password})
				}
				catch (error) {
					console.log(error)
					alert("Wrong Email or Username!")
					return
				}

				if (login.status == "SUCCESS") {
					alert("Logged in")
					return
				}
			}

			function post(sent_to, obj) {
				return new Promise(function(resolve, reject) {
					var xhttp = new XMLHttpRequest()
					xhttp.onreadystatechange = function() {
						if (this.readyState == 4 && this.status == 200) {
							var data = JSON.parse(this.responseText)
							if (data.status == "FAILURE") {
								reject(data)
							}
							else {
								resolve(data)
							}
						}
					}
					xhttp.onerror = function() {
						reject(xhttp.statusText)
					}
					xhttp.open("POST", sent_to, true)
					if (obj) {
						xhttp.setRequestHeader('Content-Type', 'application/json');
						xhttp.send(JSON.stringify(obj))
					}
					else {
						xhttp.send()
					}
				})
			}

			// document.getElementById('button').onclick = function() {
			// 	alert("button was clicked");
			// 	var email = document.getElementById("emailInput").value;
			// 	var password = document.getElementById("passwordInput").value;
			// 	$('#temp1').text(email)
			// 	$('#temp2').text(password)
			// }​;​

		</script>
	</head>

	<form action="#">
		<h4 align="center" >Email address</h4>
		<div class="row justify-content-center">
			<div class="form-group col-7">
		    	<input type="email" class="form-control" id="emailInput" aria-describedby="emailHelp" placeholder="Enter email">
		  	</div>
	  	</div>

		<h4 align="center">Password</h4>
		<div class="row justify-content-center">
			<div class="form-group col-7">
				<input type="password" class="form-control" id="passwordInput" placeholder="Password">
				<div align="center">
					<button type="button" class="btn btn-link">Forgot password?</button>
				</div>
			</div>
		</div>

		<div align="center">
			<button class="btn btn-success col-6" id="button" onclick="scrape();">Log in</button>
		</div>

		<div align="center" id="signUp">
			<text>Don't have an account?<br/></text>
			<button type="button" class="btn btn-link">Sign Up</button>
		</div>
	</form>

</html>
